 CreateTestRegistry←{
     apm dir←⍺ ⍵
     _←3 ⎕MKDIR⊢src registry←(⊂dir,'/'),¨'src' 'registry'

     ⍝ initialise new serverless registry
     rc msg←apm.CreateRegistry registry
     assert 0=rc:
     uri←apm.PathToUri registry

     ⍝ Example-Test-0.1.0
     lines←':Namespace Test' 'foo←{⍵}' ':EndNamespace'
     _←(⊂lines)NPUT src,'/Test.apln'
     cfg←⎕NS''
     cfg.group←'Example'
     cfg.name←'Test'
     cfg.version←'0.1.0'
     cfg.source←'Test.apln'
     _←(⊂⎕JSON cfg)NPUT src,'/apl-package.json'
     rc msg←apm.Publish src uri
     assert 0=rc:

     ⍝ Example-Test-0.2.0
     lines←':Namespace Test' 'inc←{⍵-1}' 'dec←{⍵-1}' ':EndNamespace'
     _←(⊂lines)NPUT src,'/Test.apln'
     cfg←⎕NS''
     cfg.group←'Example'
     cfg.name←'Test'
     cfg.version←'0.2.0'
     cfg.source←'Test.apln'
     _←(⊂⎕JSON cfg)NPUT src,'/apl-package.json'
     rc msg←apm.Publish src uri
     assert 0=rc:

     ⍝ Example-Test-0.2.1
     lines←':Namespace Test' 'inc←{⍵+1}' 'dec←{⍵-1}' ':EndNamespace'
     _←(⊂lines)NPUT src,'/Test.apln'
     cfg←⎕NS''
     cfg.group←'Example'
     cfg.name←'Test'
     cfg.version←'0.2.1'
     cfg.source←'Test.apln'
     _←(⊂⎕JSON cfg)NPUT src,'/apl-package.json'
     rc msg←apm.Publish src uri
     assert 0=rc:

     ⍝ GroupX-Math-1.0.0
     lines←,⊂'add←{⍺+⍵}'
     _←(⊂lines)NPUT src,'/add.aplf'
     cfg←⎕NS''
     cfg.group←'GroupX'
     cfg.name←'Math'
     cfg.version←'1.0.0'
     cfg.source←'add.aplf'
     _←(⊂⎕JSON cfg)NPUT src,'/apl-package.json'
     rc msg←apm.Publish src uri
     assert 0=rc:

     ⍝ GroupX-Tool-2.0.0
     lines←':Namespace Tool' 'inc←1∘##.Math.add' ':EndNamespace'
     _←(⊂lines)NPUT src,'/Tool.apln'
     cfg←⎕NS''
     cfg.group←'GroupX'
     cfg.name←'Tool'
     cfg.version←'2.0.0'
     cfg.source←'Tool.apln'
     cfg.dependencies←,⊂'GroupX-Math-1.0.0'
     _←(⊂⎕JSON cfg)NPUT src,'/apl-package.json'
     rc msg←apm.Publish src uri
     assert 0=rc:

     0 registry
 }
