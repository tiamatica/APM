 R←Test_Project_001(stopFlag batchFlag);⎕TRAP;dir;dist;lines;rc;msg;ns;registry;uri;prj_dir;_;pcfg;gcfg;cfg
⍝ Install a package in a "project" folder
 ⎕TRAP←(999 'C' '. ⍝ Deliberate error')(0 'N')
 R←∆Failed

 ns←''
 dir←getTempDir ⍬
 rc registry←APM CreateTestRegistryVersions1 dir
 →GoToTidyUp 0≠rc

 uri←APM.PathToUri registry
 rc msg gcfg←APM.AddRegistry'test'uri
 →GoToTidyUp 0≠rc

 _←3 ⎕MKDIR prj_dir←dir,'/project'
 (cfg←⎕NS'').name←'ProjectX'
 rc msg pcfg←cfg APM.InitPackage prj_dir
 →GoToTidyUp 0≠rc

 rc msg pcfg←prj_dir APM.AddPackage'GroupA-Test1-v0.1.0'
 →GoToTidyUp 0≠rc
 rc msg pcfg←prj_dir APM.AddPackage'GroupA-Test2-v2.3.0'
 →GoToTidyUp 0≠rc

 ⍝ load using exact mode (default)
 rc msg←'exact'APM.InstallPackages prj_dir
 →GoToTidyUp 0≠rc

 rc msg←APM.LoadProject prj_dir
 →GoToTidyUp 0≠rc

 →GoToTidyUp 9≠#.⎕NC cfg.name
 ns←#.⍎cfg.name

 →GoToTidyUp'0.1.0'≢ns.Test1 ⍬
 →GoToTidyUp'2.3.0-0.1.1'≢ns.Test2.Version ⍬
 ⎕EX¨cfg.name'#._apm'

 ⍝ load using latest mode
 rc msg←'latest'APM.InstallPackages prj_dir
 →GoToTidyUp 0≠rc

 rc msg←APM.LoadProject prj_dir
 →GoToTidyUp 0≠rc

 →GoToTidyUp 9≠#.⎕NC cfg.name
 ns←#.⍎cfg.name

 →GoToTidyUp'0.1.1'≢ns.Test1 ⍬
 →GoToTidyUp'2.4.0-0.2.0'≢ns.Test2.Version ⍬
 ⎕EX¨cfg.name'#._apm'

⍝ load using maxmin mode
 rc msg←'maxmin'APM.InstallPackages prj_dir
 →GoToTidyUp 0≠rc

 rc msg←APM.LoadProject prj_dir
 →GoToTidyUp 0≠rc

 →GoToTidyUp 9≠#.⎕NC cfg.name
 ns←#.⍎cfg.name

 →GoToTidyUp'0.1.1'≢ns.Test1 ⍬
 →GoToTidyUp'2.3.0-0.1.1'≢ns.Test2.Version ⍬
 ⎕EX¨cfg.name'#._apm'


 R←∆OK

∆TidyUp:
 ⎕EX⍕ns
 _←APM.RemoveRegistry'test'
 3 ⎕NDELETE dir
⍝Done
