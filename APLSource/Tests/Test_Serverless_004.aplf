 R←Test_Serverless_004(stopFlag batchFlag);⎕TRAP;dir;rc;registry;msg;cfg;packs
⍝ List packages
 ⎕TRAP←(999 'C' '. ⍝ Deliberate error')(0 'N')
 R←T._Failed

 dir←getTempDir ⍬
 rc registry←APM CreateTestRegistry dir
 →T.GoToTidyUp rc≠0

 rc msg cfg←APM.AddRegistry'TestReg'(APM.PathToUri registry)
 →T.GoToTidyUp rc≠0

 rc msg packs←'TestReg'APM.List'Example'
 →T.GoToTidyUp rc≠0
 →T.GoToTidyUp 3≠≢packs

 rc msg packs←'TestReg'APM.List'Test-v0.1'
 →T.GoToTidyUp rc≠0
 →T.GoToTidyUp 1≠≢packs
 →T.GoToTidyUp'0.1.0'≢⊃packs.version

 rc msg packs←'TestReg'APM.List'Test-v0.2'
 →T.GoToTidyUp rc≠0
 →T.GoToTidyUp 2≠≢packs
 →T.GoToTidyUp'0.2.1'≢⊃⌽packs.version

 rc msg cfg←APM.RemoveRegistry'TestReg'
 →T.GoToTidyUp rc≠0
 R←T._OK

∆TidyUp:
 3 ⎕NDELETE dir
⍝Done
