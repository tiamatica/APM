 R←Test_Registry_001(stopFlag batchFlag);⎕TRAP;rc;msg;cfg;tidyUp;uri
⍝ Add and remove a Registry from the global configuration.
 ⎕TRAP←(999 'C' '. ⍝ Deliberate error')(0 'N')
 R←T._Failed

 tidyUp←0
 rc msg cfg←APM.ReadGlobalConfig''
 →T.GoToTidyUp rc≠0
 →T.GoToTidyUp 0≠≢cfg.registries

 uri←'https://apl.registry.com'
 rc msg cfg←APM.AddRegistry'MyAlias'uri
 →T.GoToTidyUp rc≠0
 tidyUp←1

 rc msg cfg←APM.ReadGlobalConfig''
 →T.GoToTidyUp rc≠0
 →T.GoToTidyUp uri≢⊃,/cfg.registries.uri

∆TidyUp:
 :If tidyUp
     rc msg cfg←APM.RemoveRegistry'MyAlias'
     →T.PassesIf rc=0
     →T.PassesIf 0=≢cfg.registries
 :EndIf

 R←T._OK
⍝Done
